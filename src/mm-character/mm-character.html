<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<dom-module id="mm-character">
  <template>
    <h3>Rycerz</h3>
    Miecz: [[data.sword]]<br>
    Magia: [[data.magic]]<br>
    Złoto: [[data.gold]]<br>
    Życia: [[data.lifes]]<br>
    Obszar: [[data.region]]<br>
    Karta: [[data.card]]<br>
    <paper-button on-tap="_roll">Roll the dice</paper-button>
  </template>

  <script>
    'use strict';

    (function() {
      const regions = imports.regions;

      /*
       I - Encounter
       II - Enemy (Beast)
       III - Enemy (Demon)
       IV - Stranger
       V - Friend
       VI - Place
       */
      const cards = {
        godsMessangers: {
          type: 'encounter',
          title: 'Posłańcy Bogów',
          description: 'Spotkałeś potężne Dobre Duchy, wędrujące po tej Krainie. Jeżeli ty także jesteś Dobry, Duchy obdarują cię 1 punktem Życia, jeżeli jesteś Zły, tracisz 1 Życie. Posłańcy ignorują Chaotyczne Postacie. Po spotkaniu odłuż tę Kartę.',
        },
        enchantedSpring: {
          type: 'place',
          title: "Zaklęte Źródło",
          description: 'Po znalezieniu Źródła połóż przy nim 4 punkty Magii. Każdy, kto tu trafi, bedzie mógł napić się wody zyskując 1 punkt Magii i zmniejszając tym samym liczbę punktów przy źródle.',
        }
      };

      class MmCharacter extends Polymer.Element {
        static get is() {
          return 'mm-character';
        }

        static get properties() {
          return {
            data: Object,
            code: String,
          };
        }

        _roll() {
          const newRegionKey = regions[this.data.region].left;
          const newRegion = regions[newRegionKey];

          this.set('data.region', newRegionKey);
          if (newRegion.actions) {
            _.map(this._performAction.bind(this), newRegion.actions)
          }
        }

        _performAction(action) {
          console.log(action.type);
          if (action.type === 'roll') {
            const roll = _.random(1, 6);
            console.log(roll);
            _.map(this._performAction.bind(this), action.results[roll])
          }
          if (action.type === 'doubleRoll') {
            const roll = _.random(2, 12);
            console.log(roll);
            _.map(this._performAction.bind(this), action.results[roll])
          }
          if (action.type === 'addAttr') {
            console.log(action.attr, action.value);
            this.set(`data.${action.attr}`, this.data[action.attr] + action.value);
          }
          if (action.type === 'cards') {
            const cardsKeys = _.keys(cards);
            const card = cardsKeys[_.random(0, cardsKeys.length - 1)];
            console.log(card);
            this.set('data.card', card);
          }
        };
      }
      customElements.define(MmCharacter.is, MmCharacter);
    })();
  </script>
</dom-module>
